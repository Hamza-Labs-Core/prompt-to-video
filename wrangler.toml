name = "prompt-to-video"
main = "src/index.ts"
compatibility_date = "2024-12-01"

# Durable Objects for job orchestration
[durable_objects]
bindings = [
  { name = "VIDEO_JOB", class_name = "VideoJob" }
]

# SQLite-backed storage for Durable Objects
[[migrations]]
tag = "v1"
new_sqlite_classes = ["VideoJob"]

# D1 database for users and settings
[[d1_databases]]
binding = "DB"
database_name = "prompt-to-video-db"
database_id = "local" # Replace with actual ID after: wrangler d1 create prompt-to-video-db

# R2 bucket for storing images and videos
[[r2_buckets]]
binding = "MEDIA_BUCKET"
bucket_name = "prompt-to-video-media"

# KV namespace for caching and quick lookups
[[kv_namespaces]]
binding = "CACHE"
id = "prompt-to-video-cache"

# Static assets configuration
[assets]
directory = "./dist/client"
binding = "ASSETS"
not_found_handling = "single-page-application"

# Environment variables (secrets set via wrangler secret)
[vars]
ENVIRONMENT = "development"
JWT_EXPIRY = "3600"
REFRESH_EXPIRY = "604800"

# Secrets to set via: wrangler secret put <NAME>
# - JWT_SECRET: Random 256-bit key for signing JWTs
# - ENCRYPTION_KEY: Master key for encrypting API keys

# Development overrides
[env.development]
vars = { ENVIRONMENT = "development", JWT_EXPIRY = "3600", REFRESH_EXPIRY = "604800" }

# Production overrides
[env.production]
vars = { ENVIRONMENT = "production", JWT_EXPIRY = "3600", REFRESH_EXPIRY = "604800" }
